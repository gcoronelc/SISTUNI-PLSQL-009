CREATE OR REPLACE PACKAGE BODY PCK_CLIENTE AS

  PROCEDURE INSERTAR_CLIENTE(

    P_CL_DNI  IN CLIENTE.CL_DNI%TYPE,
    P_CL_NOMBRE IN CLIENTE.CL_NOMBRE%TYPE,
    P_CL_TELEFONO IN CLIENTE.CL_TELEFONO%TYPE,
    P_CL_SEXO IN CLIENTE.CL_SEXO%TYPE,
    P_CL_FECHA_NAC IN CLIENTE.CL_FECHA_NAC%TYPE,
    P_CL_DIRECCION IN CLIENTE.CL_DIRECCION%TYPE,
    P_COD_RESPUESTA       OUT NOCOPY  NUMBER,
    P_MENSAJE OUT NOCOPY  VARCHAR2

  ) AS
    V_CL_IDCLIENTE int;
    V_EXISTEDNI int;
  BEGIN  

    select count(CL_IDCLIENTE)
    into V_EXISTEDNI
    from CLIENTE 
    where P_CL_DNI=CL_DNI;
        
    IF (V_EXISTEDNI > 0) THEN
      RAISE_APPLICATION_ERROR(-20004, 'DNI DE CLIENTE YA REGISTRADO');
    END IF;
    
    select max(CL_IDCLIENTE)+1 
    into V_CL_IDCLIENTE
    from CLIENTE ;    
    
    INSERT INTO CLIENTE  
      VALUES
      (
        V_CL_IDCLIENTE,
        P_CL_DNI,
        P_CL_NOMBRE,
        P_CL_TELEFONO,
        P_CL_SEXO,
        P_CL_FECHA_NAC,
        P_CL_DIRECCION        
      );

   P_COD_RESPUESTA := 0;
   P_MENSAJE := 'CLIENTE REGISTRADO';
   COMMIT;
   
   EXCEPTION

    WHEN OTHERS THEN
      P_COD_RESPUESTA := -1;
      P_MENSAJE := TO_CHAR(sqlcode) || ' - ' || SQLERRM;
      ROLLBACK;
   
  END INSERTAR_CLIENTE;





  PROCEDURE MODIFICAR_CLIENTE(

    P_CL_IDCLIENTE  IN CLIENTE.CL_IDCLIENTE%TYPE,
    P_CL_NOMBRE IN CLIENTE.CL_NOMBRE%TYPE,
    P_CL_TELEFONO IN CLIENTE.CL_TELEFONO%TYPE,
    P_CL_SEXO IN CLIENTE.CL_SEXO%TYPE,
    P_CL_FECHA_NAC IN CLIENTE.CL_FECHA_NAC%TYPE,
    P_CL_DIRECCION IN CLIENTE.CL_DIRECCION%TYPE,
    P_COD_RESPUESTA       OUT NOCOPY  NUMBER,
    P_MENSAJE OUT NOCOPY  VARCHAR2

  ) AS
   V_EXISTECLIENTE int;
  BEGIN
  
    select count(CL_IDCLIENTE)
    into V_EXISTECLIENTE
    from CLIENTE 
    where CL_IDCLIENTE = P_CL_IDCLIENTE;
    
    IF (V_EXISTECLIENTE = 0) THEN
      RAISE_APPLICATION_ERROR(-20004, 'CLIENTE NO ESTA REGISTRADO');
    END IF;
  
  UPDATE CLIENTE
    SET  
     CL_NOMBRE          = P_CL_NOMBRE,
     CL_TELEFONO        = P_CL_TELEFONO,
     CL_SEXO            = P_CL_SEXO,
     CL_FECHA_NAC       = P_CL_FECHA_NAC,
     CL_DIRECCION       = P_CL_DIRECCION     
    WHERE CL_IDCLIENTE  = P_CL_IDCLIENTE;     
   
   P_COD_RESPUESTA := 0;
   P_MENSAJE := 'SE ACTUALIZO EL CLIENTE';
   COMMIT;
   
   EXCEPTION

    WHEN OTHERS THEN
      P_COD_RESPUESTA := -1;
      P_MENSAJE := TO_CHAR(sqlcode) || ' - ' || SQLERRM;
      ROLLBACK;
      
  END MODIFICAR_CLIENTE;




  PROCEDURE ELIMINAR_CLIENTE(
    P_CL_IDCLIENTE  IN CLIENTE.CL_IDCLIENTE%TYPE, 
    P_COD_RESPUESTA       OUT NOCOPY  NUMBER,
    P_MENSAJE OUT NOCOPY  VARCHAR2

  ) AS
    V_EXISTECLIENTE int;
  BEGIN
    select count(CL_IDCLIENTE)
    into V_EXISTECLIENTE
    from CLIENTE 
    where CL_IDCLIENTE = P_CL_IDCLIENTE;
    
    IF (V_EXISTECLIENTE = 0) THEN
      RAISE_APPLICATION_ERROR(-20004, 'CLIENTE NO EXISTE');
    END IF;
    
    DELETE
    FROM CLIENTE
    WHERE CL_IDCLIENTE = P_CL_IDCLIENTE;
    
    P_COD_RESPUESTA := 0;
    P_MENSAJE := 'SE ELIMINO AL CLIENTE';
     COMMIT;
    
  EXCEPTION

    WHEN OTHERS THEN
      P_COD_RESPUESTA := -1;
      P_MENSAJE := TO_CHAR(sqlcode) || ' - ' || SQLERRM;
      ROLLBACK;
      
  END ELIMINAR_CLIENTE;




  PROCEDURE LISTAR_CLIENTES(  
    P_CURSOR OUT NOCOPY SYS_REFCURSOR,
    P_COD_RESPUESTA       OUT NOCOPY  NUMBER,
    P_MENSAJE OUT NOCOPY  VARCHAR2

  ) AS
    V_EXISTECLIENTE int;
  BEGIN

        OPEN P_CURSOR FOR
    SELECT CL_IDCLIENTE,
      CL_DNI,      
      CL_NOMBRE,
      CL_TELEFONO,
      CL_SEXO,
      CL_FECHA_NAC,
      CL_DIRECCION      
    FROM CLIENTE 
    ;
    
    P_COD_RESPUESTA := 0;
   P_MENSAJE := 'SE SELECCIONO LOS CLIENTES';
    
   EXCEPTION

    WHEN OTHERS THEN
      P_COD_RESPUESTA := -1;
      P_MENSAJE := TO_CHAR(sqlcode) || ' - ' || SQLERRM;
  END LISTAR_CLIENTES;




  PROCEDURE LISTAR_CLIENTE_ID(
    P_CL_IDCLIENTE  IN CLIENTE.CL_IDCLIENTE%TYPE,    
    P_CURSOR OUT NOCOPY SYS_REFCURSOR,
    P_COD_RESPUESTA       OUT NOCOPY  NUMBER,
    P_MENSAJE OUT NOCOPY  VARCHAR2

  ) AS
    V_EXISTECLIENTE int;
  BEGIN
    select count(CL_IDCLIENTE)
    into V_EXISTECLIENTE
    from CLIENTE 
    where CL_IDCLIENTE = P_CL_IDCLIENTE;
    
    IF (V_EXISTECLIENTE = 0) THEN
      RAISE_APPLICATION_ERROR(-20004, 'CLIENTE NO EXISTE');
    END IF;
    
    OPEN P_CURSOR FOR
    SELECT CL_IDCLIENTE,
      CL_DNI,      
      CL_NOMBRE,
      CL_TELEFONO,
      CL_SEXO,
      CL_FECHA_NAC,
      CL_DIRECCION 
    FROM CLIENTE 
    where CL_IDCLIENTE = P_CL_IDCLIENTE;
        
    P_COD_RESPUESTA := 0;
    P_MENSAJE := 'SE SELECCCIONO CLIENTE';
    
  EXCEPTION

    WHEN OTHERS THEN
      P_COD_RESPUESTA := -1;
      P_MENSAJE := TO_CHAR(sqlcode) || ' - ' || SQLERRM;    
    
  END LISTAR_CLIENTE_ID;

END PCK_CLIENTE;